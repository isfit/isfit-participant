<ol class="breadcrumb">
  <li><%= link_to 'Dashboard', dashboard_path %></li>
  <li class="active">Participants</li>
</ol>

<%= form_tag '', method: :get do |f| %>
  <div class="form-group">
      <%= text_field_tag :search, params[:search], {placeholder: 'Who are you looking for?', class: 'form-control'} %>
    </div>
  
    <div class="form-group">
      <%= submit_tag 'Search', class: 'btn btn-primary' %>
    </div>
<% end %>

<table id="participants" class="table">
  <tr>
    <th>Full name</th>
    <th>Country</th>
    <th>Workshop</th>
    <th>Applied visa</th>
    <th>Received visa</th>
    <th>Submitted travel</th>
    <th>Confirmed</th>
  </tr>

  <% @participants.each do |a| %>
      <% puts a.user_id.to_s + " " + a.user.full_name + '\n'  %>
      <tr>
        <td><%= link_to a.user.full_name, a %></td>
        <td><%= a.user.profile ? a.user.profile.country.name : 'N/A' %></td>
        <td><%= a.workshop.title %></td>
        <td>
          <% if a.need_visa == -1 %>
            <span class="text-danger">N/A</span>
          <% elsif a.need_visa == 0 %>
            <span class="text-primary">No need</span>
          <% elsif a.need_visa == 1 && a.applied_visa == -1 %>
            <span class="text-danger">Not applied</span>
          <% elsif a.need_visa == 1 && a.applied_visa == 1 %>
            <span class="text-success">Applied</span>
          <% elsif a.need_visa == 1 && a.applied_visa == 2 %>
            <span class="text-warning">Extended</span>
          <% end %>
        </td>
        <td>
          <% if a.need_visa == -1 %>
            <span class="text-danger">N/A</span>
          <% elsif a.need_visa == 0 %>
            <span class="text-primary">No need</span>
          <% elsif a.need_visa == 1 && a.visa_number.blank? && a.approved_second_deadline == 2 %>
            <span class="text-warning">Extended</span>
          <% elsif a.need_visa == 1 && a.visa_number.blank? %>
            <span class="text-danger">Not confirmed</span>
          <% else %>
            <span class="text-success">Confirmed</span>
          <% end %>
        </td>
        <td>
          <% if a.arrival_in_norway == -1 || a.departure_trd == -1 || a.departure_norway == -1 %>
            <span class="text-danger">Not Submitted</span>
          <% else %>
            <span class="text-success">Submitted</span>
          <% end %>
        </td>
        <td>
          <% if a.approved_third_deadline == 1 %>
            <span class="text-success">Yes</span>
          <% elsif a.approved_third_deadline == 2 %>
            <span class="text-warning">Extended</span>
          <% else %>
            <%= form_for a, html: {class: 'form-inline'} do |f| %>
              <span class="text-danger">No</span>
              <%= f.hidden_field :approved_third_deadline, {value: 2} %>
              <%= f.submit 'Extend', class: 'btn btn-warning btn-xs' %>
            <% end %>
          <% end %>
        </td>
      </tr>
  <% end %>
</table>

<%= will_paginate(@participants, renderer: BootstrapPagination::Rails) %>
