<%= render 'menu' %>

<h1>Search for application</h1>

<%= search_form_for @q, :builder => SimpleForm::FormBuilder, url: search_applications_path, method: :post do |f| %>
  <% unless ControlPanel.first.app_grade3 and can?(:stats, Application) %>
    <%= f.input :first_name_cont, :label => "First name", :input_html => { :class => "span4" } %>
    <%= f.input :last_name_cont, :label => "Last name", :input_html => { :class => "span4" } %>
    <%= f.input :email_eq, :label => "Email", :input_html => { :class => "span4" } %>
  <% end %>
  <%= f.input :country_id_eq, :collection => @countries, :as => :select, 
    :label => "Country", :input_html => { :class => "span4" } %>
  <%= f.input :sex_eq, :as => :select, :label => "Sex", 
    :collection => [["female", "f"], ["male", "m"]], :input_html => { :class => "span4" }  %>
  <%= f.input :workshop1_eq, :collection => @workshops, :as => :select, 
    :label => "Workshop 1", :input_html => { :class => "span4" } %>
  <%= f.input :workshop2_eq, :collection => @workshops, :as => :select, 
    :label => "Workshop 2", :input_html => { :class => "span4" } %>
  <%= f.input :workshop3_eq, :collection => @workshops, :as => :select, 
    :label => "Workshop 3", :input_html => { :class => "span4" } %>
  <% if ControlPanel.first.app_grade3 and can?(:stats, Application) %>
    <%= f.input :status_eq, :collection => @status, :as => :select, 
      :label => "Status", :input_html => { :class => "span4" } %>
    <%= f.input :final_workshop_eq, :collection => @workshops, :as => :select, 
      :label => "Final workshop", :input_html => { :class => "span4" } %>
    <%= f.input :total_grade_gt, :label => "Total grade(greater than)", 
      :input_html => { :class => "span4" } %>
    <%= f.input :travel_status_eq, :collection => @travel_status, :as => :select,
      :label => "Travel status", :input_html => { :class => "span4" } %>
    <%= f.input :travel_apply_eq, :as => :select, 
      :label => "Applied for travel support", :collection => [["Yes", 1], ["No", 0]],
      :input_html => { :class => "span4" } %>
    <%= f.input :travel_nosupport_cancome_eq, :as => :select, 
      :label => "Can come without travel support", :collection => [["Yes", 1], ["No", 0]],
      :input_html => { :class => "span4" } %>
  <% end %>
  <%= f.submit "Search" %> 
<% end %>

A maximum of 200 applications will be listed below.<br>
<table id="result" class="table table-bordered table-striped tablesorter">
  <thead>
    <tr>
      <th>Name</th>
      <th>Country</th>
      <th>Sex</th>
      <th>Workshop 1</th>
      <% unless ControlPanel.first.app_grade3 %>
        <th>Workshop 2</th>
        <th>Workshop 3</th>  
      <% else %>
        <th>Grade</th>
        <th>Status</th>
      <% end %>
      <th>Options</th>
    </tr>
  </thead>
  <tbody>
  <% @applications.each do |application| %>
    <tr>
      <td><%= "#{application.last_name}, #{application.first_name}" %></td>
      <td><%= application.country.name %></td>
      <td><%= application.sex == "m" ? "male" : "female" %></td>
      <td><%= Workshop.find_by_id(application.workshop1).name %></td>
      <% unless ControlPanel.first.app_grade3 %>
        <td><%= Workshop.find_by_id(application.workshop2).name %></td>
        <td><%= Workshop.find_by_id(application.workshop3).name %></td>
      <% else %>
        <td><%= application.total_grade %></td>
        <td>
          <% if application.status == 0 %>
            <%= image_tag ('icons/information.png') %>
          <% elsif application.status == 1 %>
            <%= image_tag ('icons/accept.png') %>
          <% elsif application.status == 2 %>
            <%= image_tag ('icons/delete.png') %>
          <% elsif application.status == 3 %>
            <%= image_tag ('icons/time.png') %>
          <% end %>
        </td>
      <% end %>
      <td>
        <% if ControlPanel.first.app_grade3 and can?(:stats, Application) %>
          <%= link_to 'Select', selection_application_path(application.id), :class => "btn btn-primary" %>
        <% else %>
          <div class="btn-group">
            <%= link_to 'Show', application, :class => "btn btn-info" %>
            <a class="btn btn-info dropdown-toggle" data-toggle="dropdown" href="#">
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
              <li><%= link_to 'Edit', edit_application_path(application) %></li>
              <li><%= link_to 'Destroy', application, confirm: 'Are you sure?', method: :delete %></li>
            </ul>
          </div>
        <% end %>
      </td>
    </tr>
  <% end %>
</tbody>
</table>
