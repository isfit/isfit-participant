<%= render 'menu' %>

<%= content_for :sidebar_left do %>
  <li class="nav-header">Stats menu</li>
  <% if @applications.count > 0 %>
    <li><a href="#part-stats">Participants stats</a></li>
    <li><a href="#world-map">World map</a></li>
    <li><a href="#workshop-stats">Workshop stats</a></li>
    <li><a href="#part-gender">Participants gender</a></li>
    <li><a href="#part-age">Participants age</a></li>
    <li><a href="#results">Results</a></li>
  <% end %>
<% end %>

<h1>Search</h1>

<%= render 'search_form' %>

<div id="part-stats"><h2>Participants Stats</h2></div>
<p>
  <b>Applications: </b>
  <%= @applications.count %>
</p>

<% if @applications.count > 0 %>
  <p>
    <b>Travel support needed: </b>
    <%= number_to_currency(@applications.where("travel_amount < 10000 AND travel_amount > 0").sum(:travel_amount), :unit =>"$") %>
  </p>
  <p>
    <b>Applicants that can get support elsewhere: </b>
    <%= ((@applications.where("travel_nosupport_other > 0").count * 100) / @applications.count).to_i %>%
  </p>
  <p>
    <b>Applicants that can come without support: </b>
    <%= ((@applications.where("travel_nosupport_cancome > 0").count * 100) / @applications.count).to_i %>%
  </p>
  <p>
    <b>Different countries: </b>
    <%= @country_count.count %>
  </p>

  <div id="world-map"><h2>World map</h2></div>

  <%= render 'shared/participant_map' %>

  <div id="workshop-stats"><h2>Workshop stats</h2></div>

  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th>Name</th>
        <th>1st choice</th>
        <th>2nd choice</th>
        <th>3rd choice</th>
      </tr>
    </thead>
    <% @workshops.each do |workshop| %>
      <tr>
        <td><%= workshop.name %></td>
        <td><%= @workshop1_count[workshop.number].to_i > 0 ? @workshop1_count[workshop.number] : "0" %></td>
        <td><%= @workshop2_count[workshop.number].to_i > 0 ? @workshop2_count[workshop.number] : "0" %></td>
        <td><%= @workshop3_count[workshop.number].to_i > 0 ? @workshop3_count[workshop.number] : "0" %></td>
      </tr>
    <% end %>
  </table>
  <br />
  <div id="part-gender"><h2>Participants gender</h2></div>
  <%= render 'shared/participant_gender_chart' %>
  
  <div id="part-age"><h2>Participants age</h2></div>
  <%= render 'shared/participant_age' %>

  <div id="results"><h2>Results</h2></div>

  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th>Name</th>
        <th>Country</th>
        <th>1st Workshop</th>
        <th>Action</th>
      </tr>
    </thead>
    <% @applications.each do |application| %>
      <tr>
        <td><%= "#{application.last_name}, #{application.first_name}" %></td>
        <td><%= application.country.name %></td>
        <td><%= Workshop.find_by_id(application.workshop1).name %></td>
        <td><%= "N/A" %></td>
      </tr>
    <% end %>
  </table>

<% end %>
